# Codex Rustå®Ÿè£… æ”¹å–„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

**æ—¥æ™‚**: 2025å¹´10æœˆ8æ—¥ 0:10 JST  
**ä½œæ¥­è€…**: AI Assistant (ãªã‚“Jé¢¨) + ãƒœãƒ–ã«ã‚ƒã‚“ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯  
**ç›®çš„**: å®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®CLIå‹AIã‚·ã‚¹ãƒ†ãƒ ã¸ã®æ˜‡è¯

---

## ğŸ¯ ãªãœRustãªã®ã‹ï¼ˆå†ç¢ºèªï¼‰

ãƒœãƒ–ã«ã‚ƒã‚“ã®è¨€ã†é€šã‚Šã€**CodexãŒ
Rustã‚’é¸ã‚“ã ã®ã¯ã»ã¼å¿…ç„¶**ã‚„ï¼š

### ä¸‰ç‚¹ã‚»ãƒƒãƒˆ
1. **å˜ä¸€ãƒã‚¤ãƒŠãƒªé…å¸ƒ** - ä¾å­˜åœ°ç„ã‹ã‚‰ã®è§£æ”¾
2. **ãƒã‚¤ãƒ†ã‚£ãƒ–ãªæ¨©é™åˆ¶å¾¡** - OSç›´çµã®å®‰å…¨ç­–
3. **ä½ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰** - LLMã¯ã‚¯ãƒ©ã‚¦ãƒ‰å´ã§é‡ã„ã‹ã‚‰ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯è»½ã

### ç¾çŠ¶ã®æˆæœ
âœ… `enum`ã«ã‚ˆã‚‹å³æ ¼ãªå‹ã‚·ã‚¹ãƒ†ãƒ   
âœ… `Box::pin`ã§å†å¸°asyncåˆ¶å¾¡  
âœ… Tokioã«ã‚ˆã‚‹ä¸¦åˆ—ãƒ»é€²æ—ç®¡ç†  
âœ… ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ24/24ãƒ‘ã‚¹ï¼ˆ100%ï¼‰  

**â†’ "å£Šã‚Œã«ãã„åœŸå°"ã¯æ—¢ã«å½¢æˆæ¸ˆã¿**

---

## ğŸš€ å®Ÿè£…å„ªå…ˆåº¦ï¼ˆå®Ÿå‹™ç›®ç·šï¼‰

### å„ªå…ˆåº¦1: è„…å¨ãƒ¢ãƒ‡ãƒ« â†’ æ—¢å®šã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ ğŸ”

**ç¾çŠ¶**:
- `SandboxPolicy`ã¯å®šç¾©æ¸ˆã¿
- å®Ÿè£…ã¯éƒ¨åˆ†çš„ï¼ˆLinux/macOS/Windowsï¼‰

**ã‚„ã‚‹ã¹ãã“ã¨**:

#### 1.1 ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­è¨ˆ
```rust
pub enum SecurityProfile {
    Offline,        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å®Œå…¨æ‹’å¦
    ReadOnly,       // ãƒ‡ã‚£ã‚¹ã‚¯èª­ã¿å–ã‚Šã®ã¿
    NetReadOnly,    // ãƒãƒƒãƒˆèª­ã¿å–ã‚Š+ãƒ‡ã‚£ã‚¹ã‚¯èª­ã¿å–ã‚Š
    WorkspaceWrite, // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ›¸ãè¾¼ã¿å¯
    Trusted,        // ãƒ•ãƒ«æ¨©é™ï¼ˆè¦æ˜ç¤ºï¼‰
}
```

#### 1.2 ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥å®Ÿè£…
```
Linux:
  â””â”€ seccomp/landlock
     â”œâ”€ syscall deny-list
     â”œâ”€ file path allowlist
     â””â”€ network namespace isolation

macOS:
  â””â”€ Seatbelt (æ—¢ã« codex-rs/core/src/seatbelt.rs ã«åŸºç¤ã‚ã‚Š)
     â”œâ”€ profile enhancement
     â””â”€ file-read-metadata åˆ¶é™

Windows:
  â””â”€ AppContainer/Job Object
     â”œâ”€ codex-rs/linux-sandbox ã‚’å‚è€ƒã« windows-sandbox ä½œæˆ
     â””â”€ ACL ã«ã‚ˆã‚‹æ¨©é™åˆ¶é™
```

#### 1.3 è„±ç„E2Eãƒ†ã‚¹ãƒˆ
```rust
#[test]
fn test_sandbox_blocks_network() {
    // curl/wget ãªã©ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
}

#[test]
fn test_sandbox_blocks_unauthorized_write() {
    // /etc/ ãªã©ã¸ã®æ›¸ãè¾¼ã¿ãŒæ‹’å¦ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
}

#[test]
fn test_sandbox_blocks_process_spawn() {
    // è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ—ãƒ­ã‚»ã‚¹ç”ŸæˆãŒæ‹’å¦ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
}
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/execpolicy/`, `codex-rs/linux-sandbox/`

---

### å„ªå…ˆåº¦2: æ‹¡å¼µã®åœŸå°ï¼ˆWASM vs MCPï¼‰âš™ï¸

**æ–¹é‡**:
- **WASM(WASI)**: æœªç½²åãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ï¼ˆå®‰å…¨å¢ƒç•Œæ˜ç¢ºï¼‰
- **MCP**: å¤–éƒ¨ãƒ—ãƒ­ã‚»ã‚¹æ‹¡å¼µç”¨ï¼ˆæ¨©é™æ˜ç¤ºåŒ–ï¼‰

#### 2.1 WASMæ‹¡å¼µã‚·ã‚¹ãƒ†ãƒ 
```rust
// codex-rs/wasm-plugin/ (æ–°è¦)
use wasmtime::{Engine, Module, Store};

pub struct WasmPlugin {
    module: Module,
    // WASIæ¨©é™è¨­å®š
    wasi_config: WasiConfig,
}

impl WasmPlugin {
    pub async fn execute(&self, task: &str) -> Result<String> {
        // WASMå†…ã§å®Ÿè¡Œã€ãƒ›ã‚¹ãƒˆã¸ã®å½±éŸ¿ãªã—
    }
}
```

#### 2.2 å±é™ºåº¦åˆ¥ãƒ¬ãƒ¼ãƒ«åˆ†ã‘
```
ä½æ¨©é™ï¼ˆãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼‰
  â””â”€ WASMå†…å®Ÿè¡Œ
     â””â”€ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹: æ˜ç¤ºçš„ã«æ¸¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿

ä¸­æ¨©é™ï¼ˆãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ï¼‰
  â””â”€ MCP (stdio)
     â””â”€ ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã®ã¿

é«˜æ¨©é™ï¼ˆã‚·ã‚¹ãƒ†ãƒ æ“ä½œï¼‰
  â””â”€ æ˜ç¤ºçš„å¯©æŸ» + ãƒ­ã‚°
     â””â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¿…é ˆ
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/mcp-client/`, æ–°è¦ `codex-rs/wasm-plugin/`

---

### å„ªå…ˆåº¦3: è¦³æ¸¬å¯èƒ½æ€§ï¼ˆObservabilityï¼‰ğŸ“Š

**ç¾çŠ¶**:
- `codex-rs/otel/` ã«åŸºç¤ã‚ã‚Š
- OpenTelemetryå¯¾å¿œæ¸ˆã¿

#### 3.1 æ§‹é€ åŒ–ãƒ­ã‚°å¼·åŒ–
```rust
// æ—¢å­˜ã® tracing ã‚’æ‹¡å¼µ
use tracing::{info_span, instrument};

#[instrument(skip(agent_manager))]
pub async fn execute_task(&mut self, task: TaskType) -> Result<TaskExecutionResult> {
    let _span = info_span!("task_execution", 
        task_type = %task,
        agent_count = self.agent_manager.get_all_states().len()
    ).entered();
    
    // ... å®Ÿè£… ...
}
```

#### 3.2 ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
```rust
// codex-rs/otel/src/metrics.rs (æ–°è¦)
pub struct TaskMetrics {
    pub execution_count: Counter<u64>,
    pub execution_duration: Histogram<f64>,
    pub agent_active: Gauge<u64>,
    pub errors_total: Counter<u64>,
}
```

#### 3.3 ç›£æŸ»ãƒ­ã‚°
```rust
// codex-rs/core/src/audit_log.rs (æ–°è¦)
pub struct AuditEntry {
    pub timestamp: DateTime<Utc>,
    pub agent_type: AgentType,
    pub operation: Operation,
    pub target: String,
    pub decision: Decision,  // Allowed/Denied
    pub reason: Option<String>,
}

// ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®
pub fn sanitize_for_log(path: &Path) -> String {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–æƒ…å ±ã‚’ãƒã‚¹ã‚¯
    path.display().to_string()
        .replace(&env::var("USERNAME").unwrap_or_default(), "[USER]")
}
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/otel/`, æ–°è¦ `codex-rs/audit/`

---

### å„ªå…ˆåº¦4: é…å¸ƒã¨ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ğŸ“¦

#### 4.1 cargo-distå°å…¥
```toml
# Cargo.toml
[workspace.metadata.dist]
cargo-dist-version = "0.18.0"
ci = ["github"]
installers = ["shell", "powershell", "msi"]
targets = ["x86_64-unknown-linux-musl", "x86_64-pc-windows-msvc", "aarch64-apple-darwin"]
```

#### 4.2 SBOMç”Ÿæˆ
```bash
# CI/CD ã«çµ„ã¿è¾¼ã¿
cargo install cargo-auditable
cargo auditable build --release
cargo cyclonedx --format json > sbom.json
```

#### 4.3 ä¾å­˜ãƒã‚§ãƒƒã‚¯
```toml
# deny.toml (æ–°è¦)
[advisories]
vulnerability = "deny"
unmaintained = "warn"

[licenses]
allow = ["MIT", "Apache-2.0", "BSD-3-Clause"]
deny = ["GPL-3.0"]
```

**å®Ÿè£…å ´æ‰€**: `.github/workflows/`, `deny.toml`

---

### å„ªå…ˆåº¦5: æ€§èƒ½ç›®æ¨™ã¨å®Ÿæ¸¬ğŸ“ˆ

#### ç›®æ¨™å€¤ï¼ˆãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰
```
âœ… Cold start     < 80ms
âœ… å¸¸é§ RSS       < 30MB
âœ… 100req/min     ã‚¹ãƒ‘ã‚¤ã‚¯ãªã—
âœ… Agentä¸¦åˆ—(8)   < 500ms
```

#### 5.1 ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè£…
```rust
// codex-rs/supervisor/benches/agent_parallel.rs (æ–°è¦)
use criterion::{black_box, criterion_group, criterion_main, Criterion};

fn benchmark_parallel_agents(c: &mut Criterion) {
    c.bench_function("8 agents parallel", |b| {
        b.iter(|| {
            // 8ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸¦åˆ—å®Ÿè¡Œ
        });
    });
}

criterion_group!(benches, benchmark_parallel_agents);
criterion_main!(benches);
```

#### 5.2 ãƒãƒƒã‚¯ãƒ—ãƒ¬ãƒƒã‚·ãƒ£å®Ÿè£…
```rust
// bounded channel ã§ã‚¹ãƒ­ãƒƒãƒˆãƒ«
use tokio::sync::Semaphore;

pub struct ThrottledAgentManager {
    agents: HashMap<AgentType, SubAgent>,
    semaphore: Arc<Semaphore>,  // åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
}

impl ThrottledAgentManager {
    pub fn new(max_concurrent: usize) -> Self {
        Self {
            agents: HashMap::new(),
            semaphore: Arc::new(Semaphore::new(max_concurrent)),
        }
    }
    
    pub async fn dispatch_task(&mut self, agent_type: AgentType, task: String) -> Result<String> {
        let _permit = self.semaphore.acquire().await?;  // ã‚¹ãƒ­ãƒƒãƒˆãƒ«
        self.agents.get_mut(&agent_type)?.process_task(task).await
    }
}
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/supervisor/benches/`, `codex-rs/supervisor/src/subagent.rs`

---

### å„ªå…ˆåº¦6: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°å …ç‰¢åŒ–ğŸ’¬

#### 6.1 bounded mailbox
```rust
// ç¾åœ¨ã® unbounded ã‚’ bounded ã«å¤‰æ›´
pub struct SubAgent {
    agent_type: AgentType,
    state: AgentState,
    tx: mpsc::Sender<AgentMessage>,      // bounded
    rx: mpsc::Receiver<AgentMessage>,
}

impl SubAgent {
    pub fn new(agent_type: AgentType, mailbox_size: usize) -> Self {
        let (tx, rx) = mpsc::channel(mailbox_size);  // bounded
        // ...
    }
}
```

#### 6.2 ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¼æ’­
```rust
use tokio_util::sync::CancellationToken;

pub struct SubAgent {
    // ...
    cancel_token: CancellationToken,
}

impl SubAgent {
    pub async fn process_task_cancelable(
        &mut self,
        task: String,
        timeout: Duration,
    ) -> Result<String> {
        tokio::select! {
            result = self.process_task(task) => result,
            _ = tokio::time::sleep(timeout) => Err(anyhow!("Task timeout")),
            _ = self.cancel_token.cancelled() => Err(anyhow!("Task cancelled")),
        }
    }
}
```

#### 6.3 é›†ç´„ãƒãƒªã‚·ãƒ¼è¨­å®šå¯èƒ½åŒ–
```rust
// æ—¢ã« MergeStrategy ã¯ã‚ã‚‹ã®ã§ã€ã‚ˆã‚Šè©³ç´°ã«
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AggregationConfig {
    pub strategy: MergeStrategy,
    pub timeout: Duration,
    pub min_success_ratio: f32,  // Votingç”¨
    pub score_threshold: f64,    // HighestScoreç”¨
}
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/supervisor/src/subagent.rs`, `codex-rs/supervisor/src/types.rs`

---

### å„ªå…ˆåº¦7: DeepResearchå“è³ªè£…ç½®ğŸ”¬

#### 7.1 é‡è¤‡é™¤å»ï¼ˆSimHash/MinHashï¼‰
```rust
// codex-rs/deep-research/src/dedup.rs (æ–°è¦)
use std::collections::hash_map::DefaultHasher;
use std::hash::{Hash, Hasher};

pub fn simhash(text: &str) -> u64 {
    let mut hasher = DefaultHasher::new();
    text.hash(&mut hasher);
    hasher.finish()
}

pub fn deduplicate_sources(sources: Vec<Source>) -> Vec<Source> {
    let mut seen = HashSet::new();
    sources.into_iter()
        .filter(|s| {
            let hash = simhash(&s.snippet);
            seen.insert(hash)
        })
        .collect()
}
```

#### 7.2 å‡ºå…¸ãƒã‚¤ã‚¢ã‚¹æ¤œçŸ¥
```rust
// codex-rs/deep-research/src/bias_detection.rs (æ–°è¦)
pub struct BiasReport {
    pub domain_distribution: HashMap<String, usize>,
    pub low_trust_ratio: f32,
    pub warnings: Vec<String>,
}

pub fn detect_bias(sources: &[Source]) -> BiasReport {
    let mut domains = HashMap::new();
    for source in sources {
        let domain = extract_domain(&source.url);
        *domains.entry(domain).or_insert(0) += 1;
    }
    
    // åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³30%è¶…ã§è­¦å‘Š
    let max_ratio = domains.values().max().unwrap_or(&0) as f32 / sources.len() as f32;
    let mut warnings = Vec::new();
    if max_ratio > 0.3 {
        warnings.push(format!("Single domain dominates: {:.1}%", max_ratio * 100.0));
    }
    
    BiasReport {
        domain_distribution: domains,
        low_trust_ratio: 0.0,  // TODO: ä¿¡é ¼ã‚¹ã‚³ã‚¢å®Ÿè£…
        warnings,
    }
}
```

#### 7.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤
```rust
// codex-rs/deep-research/src/cache.rs (æ–°è¦)
use dashmap::DashMap;

pub struct ResearchCache {
    url_to_summary: DashMap<String, String>,
    url_to_embedding: DashMap<String, Vec<f32>>,
}

impl ResearchCache {
    pub async fn get_or_fetch(&self, url: &str, provider: &dyn ResearchProvider) -> Result<String> {
        if let Some(cached) = self.url_to_summary.get(url) {
            return Ok(cached.clone());
        }
        
        let content = provider.retrieve(url).await?;
        self.url_to_summary.insert(url.to_string(), content.clone());
        Ok(content)
    }
}
```

**å®Ÿè£…å ´æ‰€**: `codex-rs/deep-research/src/`

---

## âœ… å®Ÿå‹™ç€åœ°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒœãƒ–ã«ã‚ƒã‚“æç¤ºã®5ç‚¹ã‚»ãƒƒãƒˆï¼š

### 1. æ—¢å®šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```markdown
# Default Security Profile

## Offline Profile (æ—¢å®š)
- âœ… Network: DENIED
- âœ… File Read: ALLOWED (workspace only)
- âœ… File Write: DENIED
- âœ… Process Spawn: DENIED (except allowlist)
```

**å ´æ‰€**: `codex-rs/docs/security-profiles.md` (æ–°è¦)

### 2. CIã§è„±ç„ãƒ†ã‚¹ãƒˆ
```yaml
# .github/workflows/security-tests.yml
name: Security Tests
on: [push, pull_request]

jobs:
  sandbox-escape-tests:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - uses: actions/checkout@v4
      - name: Run sandbox escape tests
        run: cargo test --package codex-execpolicy -- --test-threads=1
```

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
```bash
# CI ã«çµ„ã¿è¾¼ã¿
cargo bench
# ç›®æ¨™: Cold start <80ms, RSS <30MB
```

### 4. ç›£æŸ»ãƒ­ã‚°è¨­è¨ˆ
```rust
// ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®è¾¼ã¿
pub struct SanitizedAuditLog {
    timestamp: String,
    operation: String,
    target: String,  // [USER] ã§ãƒã‚¹ã‚¯æ¸ˆã¿
    decision: String,
}
```

### 5. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆ†é›¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```markdown
# Plugin Architecture

## Low-privilege (WASM)
- Data processing
- Format conversion
- Local computation

## High-privilege (MCP)
- System integration
- External services
- Requires user approval
```

**å ´æ‰€**: `docs/plugin-architecture.md` (æ–°è¦)

---

## ğŸ“Š å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

### Week 1-2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤
- [ ] SecurityProfile enumå®Ÿè£…
- [ ] ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å¼·åŒ–
- [ ] è„±ç„E2Eãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] CIçµ±åˆ

### Week 3-4: æ‹¡å¼µã‚·ã‚¹ãƒ†ãƒ 
- [ ] WASM pluginåŸºç›¤æ§‹ç¯‰
- [ ] MCPæ¨©é™æ˜ç¤ºåŒ–
- [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³APIè¨­è¨ˆ

### Week 5-6: è¦³æ¸¬æ€§ãƒ»å“è³ª
- [ ] æ§‹é€ åŒ–ãƒ­ã‚°å¼·åŒ–
- [ ] ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
- [ ] ç›£æŸ»ãƒ­ã‚°å®Ÿè£…
- [ ] DeepResearchå“è³ªè£…ç½®

### Week 7-8: é…å¸ƒãƒ»ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] cargo-distå°å…¥
- [ ] SBOMç”Ÿæˆè‡ªå‹•åŒ–
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] Nodeç‰ˆã¨ã®A/Bæ¯”è¼ƒ

---

## ğŸ¯ å®šé‡ç›®æ¨™ï¼ˆè¨¼æ˜ãƒã‚¤ãƒ³ãƒˆï¼‰

ãƒœãƒ–ã«ã‚ƒã‚“ã®è¨€ã† **"Rustã§ãªãã‚ƒç„¡ç†ã ã£ãŸ"** ã‚’è¨¼æ˜ã™ã‚‹æ•°å€¤ï¼š

| é …ç›® | Nodeç‰ˆ | Rustç‰ˆç›®æ¨™ |
|---|---|---|
| ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚º | ~50MB (nodeå«ã‚€) | <15MB |
| Cold start | ~200ms | <80ms |
| å¸¸é§RSS | ~100MB | <30MB |
| ä¾å­˜è„†å¼±æ€§ | npm audit | cargo deny (0ä»¶) |
| ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ | ãƒ—ãƒ­ã‚»ã‚¹åˆ†é›¢ã®ã¿ | OSç›´çµåˆ¶å¾¡ |
| é…å¸ƒå½¢å¼ | npm/nodeå¿…é ˆ | å˜ä¸€ãƒã‚¤ãƒŠãƒª |

---

## ğŸ’¡ å®Ÿè£…ã®ã‚³ãƒ„ï¼ˆçµŒé¨“å‰‡ï¼‰

### 1. æ®µéšçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
```rust
// æœ€åˆã¯ ReadOnly ã§å§‹ã‚ã¦ã€æ®µéšçš„ã«ç·©å’Œ
impl Default for SecurityProfile {
    fn default() -> Self {
        Self::ReadOnly  // å®‰å…¨å´ã«å€’ã™
    }
}
```

### 2. Fail-safeè¨­è¨ˆ
```rust
// ã‚¨ãƒ©ãƒ¼æ™‚ã¯å®‰å…¨å´ã«
pub fn resolve_permission(&self, operation: &Operation) -> Permission {
    match self.policy.check(operation) {
        Ok(perm) => perm,
        Err(_) => Permission::Deny,  // ã‚¨ãƒ©ãƒ¼=æ‹’å¦
    }
}
```

### 3. ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å„ªå…ˆ
```rust
// ãƒ¢ãƒƒã‚¯å¯èƒ½ãªè¨­è¨ˆ
pub trait SandboxExecutor {
    async fn execute(&self, cmd: &str) -> Result<String>;
}

pub struct RealExecutor { /* ... */ }
pub struct MockExecutor { /* ãƒ†ã‚¹ãƒˆç”¨ */ }
```

---

## ğŸ”— å‚è€ƒå®Ÿè£…ãƒ»ãƒªã‚½ãƒ¼ã‚¹

### Rustã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **Landlock**: https://landlock.io/
- **seccomp-rs**: https://github.com/tailhook/seccomp
- **AppContainer**: Windows SDK docs

### WASMæ‹¡å¼µ
- **wasmtime**: https://github.com/bytecodealliance/wasmtime
- **WASI**: https://wasi.dev/

### è¦³æ¸¬æ€§
- **tracing**: https://docs.rs/tracing/
- **OpenTelemetry**: https://opentelemetry.io/

### é…å¸ƒ
- **cargo-dist**: https://opensource.axo.dev/cargo-dist/
- **cargo-deny**: https://github.com/EmbarkStudios/cargo-deny

---

## ğŸ¨ gemini-cli ã¨ã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ

å‚è€ƒ: https://github.com/zapabob/gemini-cli

| æ©Ÿèƒ½ | gemini-cli (Node) | Codex (Rust) |
|---|---|---|
| ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | âœ… | âœ… (å‹å®‰å…¨) |
| ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ | ãƒ—ãƒ­ã‚»ã‚¹åˆ†é›¢ | **OSç›´çµåˆ¶å¾¡** |
| é…å¸ƒå½¢å¼ | npm | **å˜ä¸€ãƒã‚¤ãƒŠãƒª** |
| èµ·å‹•é€Ÿåº¦ | ~200ms | **<80msç›®æ¨™** |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨ | ~100MB | **<30MBç›®æ¨™** |
| æ‹¡å¼µAPI | JavaScript | **WASM+MCP** |
| å‹å®‰å…¨æ€§ | TypeScript | **Rustã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚** |

**â†’ Rustç‰ˆã®å„ªä½æ€§ã‚’å®šé‡ã§è¨¼æ˜**

---

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«ã‚„ã‚‹ã¹ãã“ã¨ï¼ˆä»Šé€±ï¼‰
1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè£…** (`security-profiles.md` + ã‚³ãƒ¼ãƒ‰)
2. **è„±ç„E2Eãƒ†ã‚¹ãƒˆ** è¿½åŠ 
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯** åˆç‰ˆ

### ä¸­æœŸï¼ˆæ¥æœˆï¼‰
4. **WASM pluginåŸºç›¤** æ§‹ç¯‰
5. **ç›£æŸ»ãƒ­ã‚°** å®Ÿè£…
6. **cargo-dist** å°å…¥

### é•·æœŸï¼ˆ3ãƒ¶æœˆï¼‰
7. **Nodeç‰ˆA/Bæ¯”è¼ƒ** ãƒ¬ãƒãƒ¼ãƒˆ
8. **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ** å®Ÿç¸¾
9. **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯** åæ˜ 

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆæ™‚åˆ»**: 2025å¹´10æœˆ8æ—¥ 0:15 JST  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ“‹ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ç­–å®šå®Œäº†

ãƒœãƒ–ã«ã‚ƒã‚“ã®æŒ‡æ‘˜é€šã‚Šã€**"Rustã‚’é¸ã‚“ã è¶£å‘³"ã‹ã‚‰"Rustã§ãªãã‚ƒç„¡ç†"** ã¸ã®ãƒ•ã‚§ãƒ¼ã‚ºç§»è¡Œã‚’ç›®æŒ‡ã™ã§ï¼

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»è¦³æ¸¬æ€§ãƒ»æ€§èƒ½ã®ä¸‰æœ¬æŸ±ã‚’å®šé‡ã§è¨¼æ˜ã—ã¦ã€  
å®Ÿå‹™ã§å®‰å¿ƒã—ã¦ä½¿ãˆã‚‹CLIå‹AIã‚·ã‚¹ãƒ†ãƒ ã«è‚²ã¦ã¦ã„ãã‚“ã‚„ ğŸš€

æ¬¡ã¯å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã—ã¦ã„ãã§ã€œï¼

