# AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Œå…¨å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ ğŸ“

**å®Ÿè£…æ—¥**: 2025å¹´10æœˆ10æ—¥ 16:12  
**ã‚³ãƒŸãƒƒãƒˆ**: 9c1a4ce8  
**ãƒ–ãƒ©ãƒ³ãƒ**: zapabob/codex main  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.47.0-alpha.1

---

## ğŸ¯ å®Ÿè£…æ¦‚è¦

AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã®**5å¤§ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**ã«åŸºã¥ã„ã¦ã€ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æœ¬æ ¼å®Ÿè£…ã—ãŸã§ã€œğŸ’ª

### å‚è€ƒè³‡æ–™

- **Qiita**: AI Agentã®ä½œã‚Šæ–¹
- **AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒŠãƒ“**: AI Agentå®Ÿè£…ã‚¬ã‚¤ãƒ‰
- **Google Cloud**: AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè·µã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯

---

## âœ… 5å¤§ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…

### 1. æ˜ç¢ºãªè¦ä»¶å®šç¾©ã¨æ®µéšçš„ãªå®Ÿè£… ğŸ“

**å®Ÿè£…å†…å®¹**:
- âœ… CodexExecutorã®æ®µéšçš„å®Ÿè£…
- âœ… è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
- âœ… å°ã•ãªæ©Ÿèƒ½å˜ä½ã§ã®æ¤œè¨¼

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```rust
/// Codex executor for real LLM calls
/// Implements AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:
/// 1. æ˜ç¢ºãªè¦ä»¶å®šç¾©ã¨æ®µéšçš„ãªå®Ÿè£…
pub struct CodexExecutor {
    config: Arc<Config>,
    auth_manager: Arc<AuthManager>,
    metrics: ExecutionMetrics,
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®é€æ˜æ€§å‘ä¸Š
- ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“
- æ®µéšçš„ãªæ©Ÿèƒ½è¿½åŠ ãŒå¯èƒ½

---

### 2. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ ğŸ”€

**å®Ÿè£…å†…å®¹**:
- âœ… ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹: å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- âœ… æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹: å®Ÿéš›ã®LLMå‘¼ã³å‡ºã—
- âœ… æœ€é©ãªçµ„ã¿åˆã‚ã›

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        RealSubAgentWithExecutor             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Rule-Based     â”‚â†’ â”‚  ML-Based        â”‚  â”‚
â”‚  â”‚ (Agent Prompts)â”‚  â”‚  (Codex LLM)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“               â†“              â”‚
â”‚         Combined Result                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```rust
pub async fn execute_task(
    &mut self,
    agent_type: &AgentType,
    task: &str,
) -> Result<String> {
    // 1. ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹: å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—
    let specialized_prompt = get_agent_prompt(agent_type, task);
    
    // 2. MLãƒ™ãƒ¼ã‚¹: Codex LLMå‘¼ã³å‡ºã—
    let result = self.execute_with_codex(&specialized_prompt).await?;
    
    Ok(result)
}
```

---

### 3. ç’°å¢ƒèªè­˜èƒ½åŠ›ã®å¼·åŒ– ğŸ‘ï¸

**å®Ÿè£…å†…å®¹**:
- âœ… ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå›ºæœ‰ã®å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- âœ… ã‚¿ã‚¹ã‚¯åˆ†é¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAutonomousDispatcherï¼‰
- âœ… ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç†è§£

**å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼ˆCodeExpertï¼‰**:
```markdown
# Role: CodeExpert - Code Analysis & Implementation Specialist

## Expertise
- Code analysis and review
- Implementation of complex features
- Refactoring and optimization
- Design pattern application

## Approach
1. Analyze the code or requirements thoroughly
2. Identify potential issues
3. Provide clear recommendations
4. Implement solutions following best practices
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚¿ã‚¹ã‚¯ã«å¿œã˜ãŸæœ€é©ãªå‡¦ç†
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å°‚é–€æ€§å‘ä¸Š
- é«˜å“è³ªãªå‡ºåŠ›

---

### 4. ç¶™ç¶šçš„ãªå­¦ç¿’ã¨æ”¹å–„ ğŸ“ˆ

**å®Ÿè£…å†…å®¹**:
- âœ… ExecutionMetricsåé›†
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- âœ… ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ§‹é€ **:
```rust
#[derive(Debug, Clone, Default)]
pub struct ExecutionMetrics {
    pub total_calls: u64,
    pub successful_calls: u64,
    pub failed_calls: u64,
    pub total_tokens: u64,
    pub average_latency_ms: u64,
}
```

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ¬ãƒãƒ¼ãƒˆä¾‹**:
```
ğŸ“Š Codex Executor Metrics

Total Calls: 42
Successful: 40
Failed: 2
Success Rate: 95.24%
Average Latency: 1250ms
Total Tokens: 85000
```

**ç¶™ç¶šçš„æ”¹å–„ãƒ•ãƒ­ãƒ¼**:
```
1. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
   â†“
2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
   â†“
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
   â†“
4. æ”¹å–„ç‚¹ç‰¹å®š
   â†“
5. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–
   â†“
(1ã«æˆ»ã‚‹)
```

---

### 5. é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ğŸ› ï¸

**å®Ÿè£…å†…å®¹**:
- âœ… Codex: LLMçµ±åˆ
- âœ… Tokio: éåŒæœŸå‡¦ç†
- âœ… Tracing: ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- âœ… anyhow: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer          â”‚
â”‚  RealSubAgentWithExecutor          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Framework Layer             â”‚
â”‚  CodexExecutor                     â”‚
â”‚  AutonomousDispatcher              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Core Layer                 â”‚
â”‚  Codex (LLM)                       â”‚
â”‚  Tokio (Async Runtime)             â”‚
â”‚  Tracing (Logging)                 â”‚
â”‚  anyhow (Error Handling)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾å­˜é–¢ä¿‚**:
```toml
[dependencies]
codex-core = { workspace = true }      # LLMå®Ÿè¡Œ
codex-protocol = { workspace = true }  # ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®šç¾©
tokio = { features = ["full"] }        # éåŒæœŸå‡¦ç†
tracing = { workspace = true }         # ãƒ­ã‚°
anyhow = { workspace = true }          # ã‚¨ãƒ©ãƒ¼
dirs = { workspace = true }            # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

---

## ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

### 1. `codex_executor.rs` (298è¡Œ)

**å½¹å‰²**: å®Ÿéš›ã®Codex LLMå‘¼ã³å‡ºã—ã‚¨ãƒ³ã‚¸ãƒ³

**ä¸»è¦æ©Ÿèƒ½**:
```rust
pub struct CodexExecutor {
    config: Arc<Config>,
    auth_manager: Arc<AuthManager>,
    metrics: ExecutionMetrics,
}

impl CodexExecutor {
    // 1. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
    pub async fn execute_task(&mut self, agent_type: &AgentType, task: &str) -> Result<String>
    
    // 2. Codexå‘¼ã³å‡ºã—
    async fn execute_with_codex(&self, prompt: &str) -> Result<String>
    
    // 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹åé›†
    async fn collect_response(&self, codex: &mut Codex, timeout: Duration) -> Result<String>
    
    // 4. ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
    fn update_metrics(&mut self, success: bool, latency_ms: u64)
    
    // 5. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    pub fn generate_metrics_report(&self) -> String
}
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨ç®‡æ‰€**:
- âœ… æ®µéšçš„å®Ÿè£…: execute_task â†’ execute_with_codex â†’ collect_response
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚¨ãƒ©ãƒ¼å‡¦ç†
- âœ… ç¶™ç¶šçš„æ”¹å–„: ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
- âœ… ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°: å„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ­ã‚°å‡ºåŠ›

---

### 2. `real_subagent_with_executor.rs` (203è¡Œ)

**å½¹å‰²**: CodexExecutorçµ±åˆç‰ˆã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

**ä¸»è¦æ©Ÿèƒ½**:
```rust
pub struct RealSubAgentWithExecutor {
    agent_type: AgentType,
    state: Arc<Mutex<AgentState>>,
    tx: mpsc::UnboundedSender<AgentMessage>,
    rx: Arc<Mutex<mpsc::UnboundedReceiver<AgentMessage>>>,
    executor: Arc<Mutex<CodexExecutor>>,
}

impl RealSubAgentWithExecutor {
    // 1. ã‚¿ã‚¹ã‚¯å‡¦ç†ï¼ˆCodexçµ±åˆï¼‰
    pub async fn process_task(&self, task: String) -> Result<String>
    
    // 2. çŠ¶æ…‹å–å¾—
    pub async fn get_state(&self) -> AgentState
    
    // 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
    pub async fn send_message(&self, message: AgentMessage) -> Result<()>
    pub async fn receive_message(&self) -> Option<AgentMessage>
}

pub struct RealSubAgentManagerWithExecutor {
    agents: Arc<Mutex<HashMap<AgentType, RealSubAgentWithExecutor>>>,
    executor: Arc<Mutex<CodexExecutor>>,
}
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨ç®‡æ‰€**:
- âœ… ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆagent_promptsï¼‰ + LLMï¼ˆCodexExecutorï¼‰
- âœ… éåŒæœŸå‡¦ç†: Tokio + Arc<Mutex>
- âœ… ç¶™ç¶šçš„æ”¹å–„: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ¬ãƒãƒ¼ãƒˆå–å¾—

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Cursor IDE / MCP                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MCP Server (subagent_tool_handler)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  start_task / auto_dispatch / get_status              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        RealSubAgentManagerWithExecutor                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CodeExpert  SecurityExpert  TestingExpert  ...       â”‚ â”‚
â”‚  â”‚      â†“             â†“              â†“                   â”‚ â”‚
â”‚  â”‚  RealSubAgentWithExecutor (x8)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CodexExecutor                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾— (agent_prompts)                â”‚ â”‚
â”‚  â”‚  2. Codex::spawn                                       â”‚ â”‚
â”‚  â”‚  3. Op::UserTurné€ä¿¡                                   â”‚ â”‚
â”‚  â”‚  4. Eventåé›†                                          â”‚ â”‚
â”‚  â”‚  5. ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Codex Core (LLM)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OpenAI GPT-4o-mini / Other LLMs                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ ä¸»è¦æ©Ÿèƒ½ãƒ•ãƒ­ãƒ¼

### ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
1. Cursor â†’ MCP Server
   â†“
2. subagent_tool_handler
   parse_agent_type()
   â†“
3. RealSubAgentManagerWithExecutor
   dispatch_task()
   â†“
4. RealSubAgentWithExecutor
   process_task()
   â†“
5. CodexExecutor
   execute_task()
   â”œâ”€ get_agent_prompt()  â† å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰
   â””â”€ execute_with_codex() â† LLMå‘¼ã³å‡ºã—ï¼ˆMLãƒ™ãƒ¼ã‚¹ï¼‰
      â”œâ”€ Codex::spawn()
      â”œâ”€ submit(Op::UserTurn)
      â”œâ”€ collect_response()
      â”‚  â”œâ”€ EventMsg::Text
      â”‚  â”œâ”€ EventMsg::AgentMessage
      â”‚  â””â”€ EventMsg::TurnComplete
      â””â”€ update_metrics()  â† ç¶™ç¶šçš„æ”¹å–„
   â†“
6. Result â†’ Cursor
```

---

## ğŸ“Š å®Ÿè£…çµ±è¨ˆ

| ã‚«ãƒ†ã‚´ãƒª | æ•°å€¤ |
|---------|------|
| **æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«** | 2å€‹ |
| **å®Ÿè£…è¡Œæ•°** | ç´„500è¡Œ |
| **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹** | 5å€‹ |
| **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨** | 5åŸå‰‡å…¨ã¦ |
| **å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ** | 8ç¨®é¡ |
| **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¨®é¡** | 8ç¨®é¡ |
| **ä¾å­˜é–¢ä¿‚è¿½åŠ ** | 4å€‹ |

---

## ğŸ¨ ã‚³ãƒ¼ãƒ‰å“è³ª

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```rust
// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†
let event = timeout(timeout_duration, codex.next_event())
    .await
    .context("Timeout waiting for Codex response")?
    .context("Failed to receive event")?;

// ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
EventMsg::Error(err) => {
    error!("Codex error: {}", err.error);
    return Err(anyhow::anyhow!("Codex error: {}", err.error));
}
```

### ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

```rust
info!(
    "ğŸš€ Starting Codex execution for {} agent: {}",
    agent_type,
    task.chars().take(50).collect::<String>()
);

debug!("Specialized prompt prepared for {}", agent_type);

warn!("Empty response from Codex");
```

### éåŒæœŸå‡¦ç†

```rust
// Arc<Mutex> ãƒ‘ã‚¿ãƒ¼ãƒ³
let executor = Arc::clone(&self.executor);
let mut executor = executor.lock().await;

// mpscãƒãƒ£ãƒãƒ«
let (tx, rx) = mpsc::unbounded_channel();
```

---

## ğŸš€ ä½¿ç”¨ä¾‹

### Cursorã‹ã‚‰ä½¿ç”¨

```javascript
// 1. CodeExpertå‘¼ã³å‡ºã—
{
  "tool": "codex-subagent",
  "arguments": {
    "action": "start_task",
    "agent_type": "CodeExpert",
    "task": "Analyze this Rust function for bugs"
  }
}

// 2. Auto-dispatchï¼ˆæ¨å¥¨ï¼‰
{
  "tool": "codex-subagent",
  "arguments": {
    "action": "auto_dispatch",
    "task": "Optimize database query performance"
  }
}
// â†’ PerformanceExpertã«è‡ªå‹•æŒ¯ã‚Šåˆ†ã‘
```

### ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ä½¿ç”¨

```rust
use codex_supervisor::{CodexExecutor, RealSubAgentManagerWithExecutor, AgentType};

// 1. CodexExecutorä½œæˆ
let config = Config::default();
let auth_manager = AuthManager::shared(config.codex_home.clone(), false);
let executor = CodexExecutor::new(config, auth_manager);

// 2. Managerä½œæˆ
let manager = RealSubAgentManagerWithExecutor::new(executor);
manager.register_all_agents().await;

// 3. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
let result = manager
    .dispatch_task(AgentType::CodeExpert, "Analyze code".to_string())
    .await?;

// 4. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç¢ºèª
let report = manager.get_metrics_report().await;
println!("{}", report);
```

---

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨ã¾ã¨ã‚

### 1. æ˜ç¢ºãªè¦ä»¶å®šç¾©ã¨æ®µéšçš„ãªå®Ÿè£… âœ…

- **å®Ÿè£…**: CodexExecutorã€æ®µéšçš„ãªé–¢æ•°è¨­è¨ˆ
- **åŠ¹æœ**: ãƒ‡ãƒãƒƒã‚°å®¹æ˜“ã€æ©Ÿèƒ½è¿½åŠ ãŒç°¡å˜

### 2. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ âœ…

- **å®Ÿè£…**: å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ + Codex LLMï¼ˆMLï¼‰
- **åŠ¹æœ**: æŸ”è»Ÿæ€§ã¨å°‚é–€æ€§ã®ä¸¡ç«‹

### 3. ç’°å¢ƒèªè­˜èƒ½åŠ›ã®å¼·åŒ– âœ…

- **å®Ÿè£…**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå›ºæœ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ã‚¿ã‚¹ã‚¯åˆ†é¡
- **åŠ¹æœ**: é«˜å“è³ªãªå‡ºåŠ›ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç†è§£

### 4. ç¶™ç¶šçš„ãªå­¦ç¿’ã¨æ”¹å–„ âœ…

- **å®Ÿè£…**: ExecutionMetricsã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **åŠ¹æœ**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯è¦–åŒ–ã€ç¶™ç¶šçš„æ”¹å–„

### 5. é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ âœ…

- **å®Ÿè£…**: Codexã€Tokioã€Tracingã€anyhow
- **åŠ¹æœ**: é–‹ç™ºåŠ¹ç‡å‘ä¸Šã€ä¿å®ˆæ€§å‘ä¸Š

---

## ğŸŠ å®Œæˆã‚„ã€œï¼

**AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹5åŸå‰‡ã®å®Œå…¨å®Ÿè£…å®Œäº†ï¼ğŸ‰**

### å®Ÿè£…ã®ç‰¹å¾´

âœ… **æ®µéšçš„å®Ÿè£…**: ã‚·ãƒ³ãƒ—ãƒ«ã‹ã‚‰è¤‡é›‘ã¸  
âœ… **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**: ãƒ«ãƒ¼ãƒ« + ML  
âœ… **ç’°å¢ƒèªè­˜**: å°‚é–€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ  
âœ… **ç¶™ç¶šçš„æ”¹å–„**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†  
âœ… **é©åˆ‡ãªãƒ„ãƒ¼ãƒ«**: æœ€æ–°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯  

### ä»Šã™ãä½¿ãˆã‚‹ï¼

1. âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†
2. âœ… ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…æ¸ˆã¿
3. âœ… Cursorçµ±åˆè¨­å®šæ¸ˆã¿
4. âœ… **Cursorã‚’å†èµ·å‹•ã™ã‚‹ã ã‘ï¼**

---

**ã“ã‚Œã§ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‹•ä½œã™ã‚‹ã§ã€œï¼ğŸ’ªâœ¨**

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ãŸæœ¬æ ¼å®Ÿè£…ã‚„ã€œï¼ğŸ˜ğŸš€**

